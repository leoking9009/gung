<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API ë””ë²„ê¹…</title>
    <style>
        body {
            font-family: monospace;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .container {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
        }
        input, button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        input {
            background: #3c3c3c;
            color: #d4d4d4;
        }
        button {
            background: #0e639c;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #1177bb;
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .log {
            background: #1e1e1e;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #3c3c3c;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        .info { color: #569cd6; }
        h1 { color: #4ec9b0; }
        h3 { color: #569cd6; margin-top: 20px; }
        a { color: #4ec9b0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Gemini API ì§„ë‹¨ ë„êµ¬</h1>

        <div style="background: #3c3c3c; padding: 15px; border-radius: 4px; margin: 15px 0;">
            <strong class="info">ğŸ“ API í‚¤ ë°œê¸‰ ë‹¨ê³„:</strong><br>
            1. <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> ì ‘ì†<br>
            2. "Create API key" í´ë¦­<br>
            3. "Create API key in new project" ì„ íƒ<br>
            4. ìƒì„±ëœ í‚¤(AIzaë¡œ ì‹œì‘)ë¥¼ ë³µì‚¬<br>
            5. ì•„ë˜ì— ë¶™ì—¬ë„£ê¸°
        </div>

        <input type="password" id="apiKey" placeholder="API í‚¤ ì…ë ¥ (AIzaSy...)">

        <button onclick="runDiagnostics()">ğŸš€ ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</button>

        <h3>ğŸ“Š ì§„ë‹¨ ê²°ê³¼:</h3>
        <div class="log" id="log">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = {
                'success': 'success',
                'error': 'error',
                'warning': 'warning',
                'info': 'info'
            }[type] || 'info';

            logDiv.innerHTML += `<span class="${color}">[${timestamp}] ${message}</span><br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function testModel(apiKey, version, model) {
            const url = `https://generativelanguage.googleapis.com/${version}/models/${model}:generateContent?key=${apiKey}`;

            log(`í…ŒìŠ¤íŠ¸ ì¤‘: ${model} (${version})`, 'info');
            log(`URL: ${url.replace(apiKey, 'API_KEY')}`, 'info');

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: "ì•ˆë…•í•˜ì„¸ìš”" }]
                        }]
                    })
                });

                log(`ì‘ë‹µ ìƒíƒœ: ${response.status}`, response.ok ? 'success' : 'error');

                const data = await response.json();
                log(`ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data).substring(0, 200)}...`, 'info');

                if (response.ok) {
                    log(`âœ… ì„±ê³µ! ${model} (${version}) - ì‘ë‹µ: "${data.candidates[0].content.parts[0].text.substring(0, 50)}..."`, 'success');
                    return { success: true, model, version, data };
                } else {
                    log(`âŒ ì‹¤íŒ¨: ${model} - ${response.status} ${data.error?.message || JSON.stringify(data)}`, 'error');
                    return { success: false, model, version, status: response.status, error: data.error };
                }
            } catch (error) {
                log(`âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${model} - ${error.message}`, 'error');
                return { success: false, model, version, error: error.message };
            }
        }

        async function checkApiKeyFormat(apiKey) {
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            log('1ï¸âƒ£ API í‚¤ í˜•ì‹ ê²€ì‚¬', 'warning');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');

            if (!apiKey || apiKey.trim() === '') {
                log('âŒ API í‚¤ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤', 'error');
                return false;
            }

            if (!apiKey.startsWith('AIza')) {
                log('âš ï¸ ê²½ê³ : API í‚¤ê°€ AIzaë¡œ ì‹œì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'warning');
                log(`í˜„ì¬ ì‹œì‘ ë¬¸ì: ${apiKey.substring(0, 4)}`, 'warning');
            } else {
                log('âœ… API í‚¤ í˜•ì‹ ì •ìƒ (AIzaë¡œ ì‹œì‘)', 'success');
            }

            log(`í‚¤ ê¸¸ì´: ${apiKey.length}ì`, 'info');
            return true;
        }

        async function testAllModels(apiKey) {
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            log('2ï¸âƒ£ ëª¨ë“  Gemini ëª¨ë¸ í…ŒìŠ¤íŠ¸', 'warning');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');

            const models = [
                { version: 'v1beta', model: 'gemini-pro' },
                { version: 'v1beta', model: 'gemini-1.5-pro' },
                { version: 'v1beta', model: 'gemini-1.5-flash' },
                { version: 'v1beta', model: 'gemini-1.5-flash-latest' },
                { version: 'v1', model: 'gemini-1.5-pro' },
                { version: 'v1', model: 'gemini-1.5-flash' },
            ];

            const results = [];

            for (const { version, model } of models) {
                const result = await testModel(apiKey, version, model);
                results.push(result);
                await new Promise(resolve => setTimeout(resolve, 500)); // 0.5ì´ˆ ëŒ€ê¸°
            }

            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            log('3ï¸âƒ£ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½', 'warning');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');

            const successful = results.filter(r => r.success);
            const failed = results.filter(r => !r.success);

            if (successful.length > 0) {
                log(`âœ… ì„±ê³µí•œ ëª¨ë¸: ${successful.length}ê°œ`, 'success');
                successful.forEach(r => {
                    log(`   - ${r.model} (${r.version})`, 'success');
                });

                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log('ğŸ’¡ ê¶Œì¥ ì‚¬í•­:', 'warning');
                log(`ì•±ì—ì„œ ì‚¬ìš©í•  ëª¨ë¸: ${successful[0].model} (${successful[0].version})`, 'success');
            } else {
                log(`âŒ ì„±ê³µí•œ ëª¨ë¸ì´ ì—†ìŠµë‹ˆë‹¤`, 'error');
            }

            if (failed.length > 0) {
                log(`âŒ ì‹¤íŒ¨í•œ ëª¨ë¸: ${failed.length}ê°œ`, 'error');

                // ì˜¤ë¥˜ íŒ¨í„´ ë¶„ì„
                const errors = failed.map(r => r.error?.message || r.error || 'Unknown');
                const uniqueErrors = [...new Set(errors)];

                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log('4ï¸âƒ£ ì˜¤ë¥˜ ë¶„ì„:', 'warning');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');

                uniqueErrors.forEach(err => {
                    log(`â€¢ ${err}`, 'error');
                });

                // í•´ê²° ë°©ë²• ì œì•ˆ
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log('ğŸ”§ í•´ê²° ë°©ë²•:', 'warning');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');

                if (uniqueErrors.some(e => e.includes('API key not valid') || e.includes('401'))) {
                    log('1. API í‚¤ë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš”', 'warning');
                    log('2. Google AI Studioì—ì„œ í‚¤ë¥¼ ì‚­ì œí•˜ê³  ìƒˆë¡œ ë°œê¸‰í•˜ì„¸ìš”', 'warning');
                    log('3. í‚¤ë¥¼ ë³µì‚¬í•  ë•Œ ê³µë°±ì´ í¬í•¨ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”', 'warning');
                }

                if (uniqueErrors.some(e => e.includes('not found') || e.includes('404'))) {
                    log('1. í•´ë‹¹ ëª¨ë¸ì´ ì•„ì§ ì‚¬ìš© ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'warning');
                    log('2. API ë²„ì „(v1/v1beta)ì„ í™•ì¸í•˜ì„¸ìš”', 'warning');
                }

                if (uniqueErrors.some(e => e.includes('quota') || e.includes('429'))) {
                    log('1. ë¬´ë£Œ í• ë‹¹ëŸ‰ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤', 'warning');
                    log('2. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”', 'warning');
                }
            }

            return successful.length > 0;
        }

        async function runDiagnostics() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = '';

            if (!await checkApiKeyFormat(apiKey)) {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log('â›” ì§„ë‹¨ ì¤‘ë‹¨: API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            log('', 'info');
            await testAllModels(apiKey);

            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            log('âœ… ì§„ë‹¨ ì™„ë£Œ', 'success');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        }
    </script>
</body>
</html>
